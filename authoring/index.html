<!DOCTYPE html><html lang=en data-version=e7b9a32><head><meta name=baidu-site-verification content=B6g9i6m6tg><meta charset=utf-8><title>写一个属于你的 Yeoman Generator | Yeoman 中文网</title><meta name=viewport content="width=device-width"><meta name=description content=yeoman中文网，yeoman中文官网，yeoman是一个前端自动化脚手架工具。><meta name=keywords content=yeoman中文网，yeoman中文官网，yeoman，yowebapp，前端脚手架><link rel=icon type=image/x-icon href=/static/favicon.b25e58c4b8.ico><meta name=google-site-verification content=fBQRJ6h7MV7_TJ7grbgq4P-d-07NRfDWPe4pqEEoH5w><link href="//fonts.gmirror.org/css?family=Roboto+Slab:400,700%7CRoboto:400,700,700italic,400italic" rel=stylesheet><link rel=stylesheet href=/static/bundle-5077.fcaecd9912.css><link href=/blog/atom.xml type=application/atom+xml rel=alternate title="Yeoman Blog Atom Feed"></head><body class=documentation><header class=page-header><div class=container><div class=mobile-bar><h1 class=logo><a href=/ ><img src=/static/logo.2a54d87108.png alt="Yeoman 中文网"></a></h1><button class="mobile-menu-toggle ir">open</button></div><nav class=main-menu><ul class=main-nav><li><a href=/learning/ >使用 Yeoman</a><ul> <li><a href=/learning/index.html>起步</a></li> <li><a href=/codelab/index.html>指引 (codelab)</a></li> <li><a href=/learning/resources.html>资源</a></li> <li><a href=/learning/deployment.html>部署</a></li> <li><a href=/learning/faq.html>FAQ</a></li> <li><a href=/learning/support.html>支持</a></li></ul></li><li><a href=/generators/ >寻找 generators</a></li> <li><a href=/authoring/ class=active>创建一个 generator</a><ul> <li><a href=/authoring/index.html class=active>起步</a></li> <li><a href=/authoring/running-context.html>启动环境</a></li> <li><a href=/authoring/user-interactions.html>用户交互</a></li> <li><a href=/authoring/composability.html>可组合性</a></li> <li><a href=/authoring/dependencies.html>管理依赖</a></li> <li><a href=/authoring/file-system.html>文件系统交互</a></li> <li><a href=/authoring/gruntfile.html>创建 Gruntfile</a></li> <li><a href=/authoring/storage.html>保存用户设置</a></li> <li><a href=/authoring/testing.html>单元测试</a></li> <li><a href=/authoring/debugging.html>Generators 调试</a></li> <li><a href=/authoring/integrating-yeoman.html>整合 yeoman 工具</a></li> <li><a href=http://yeoman.io/generator/ >API 文档</a></li></ul></li><li><a href=/blog/ >博客</a></li> <li><a href=/contributing/ >贡献</a><ul> <li><a href=/contributing/index.html>贡献</a></li> <li><a href=/contributing/opening-issues.html>怎样提问</a></li> <li><a href=/contributing/pull-request.html>怎样提交一个 PR</a></li> <li><a href=/contributing/style-guide.html>书写规范</a></li> <li><a href=/contributing/testing-guidelines.html>测试指南</a></li> <li><a href=/contributing/ticketing.html>常见问题</a></li></ul></li></ul></nav></div></header><div class=SiteWrapper><div id=content><h2 class=page-title><span class=container>写一个属于你的 Yeoman Generator</span></h2><div class="container clearfix has-sidebar"><nav class=context-nav><ul><li><a href=/authoring/index.html class=active>起步</a></li> <li><a href=/authoring/running-context.html>启动环境</a></li> <li><a href=/authoring/user-interactions.html>用户交互</a></li> <li><a href=/authoring/composability.html>可组合性</a></li> <li><a href=/authoring/dependencies.html>管理依赖</a></li> <li><a href=/authoring/file-system.html>文件系统交互</a></li> <li><a href=/authoring/gruntfile.html>创建 Gruntfile</a></li> <li><a href=/authoring/storage.html>保存用户设置</a></li> <li><a href=/authoring/testing.html>单元测试</a></li> <li><a href=/authoring/debugging.html>Generators 调试</a></li> <li><a href=/authoring/integrating-yeoman.html>整合 yeoman 工具</a></li> <li><a href=http://yeoman.io/generator/ >API 文档</a></li></ul></nav><article class=main><section class=content-chunk><p>Generators 是 Yeoman 生态系统的基础。它是一个重要组件，运行 <code>yo</code> 为终端用户生成项目文件。</p><p>在这部分，你将学习如何创建和分配自己的项目。</p><aside class=excerpt>Note: 我们将建立一个 <a href=https://github.com/yeoman/generator-generator>generator-generator</a> 去帮助用户去开始他们自己的 generator。一旦你理解下面的概念，就可以自由地使用它来引导你自己的 generator。</aside><h2>组织你的 generators</h2><h3>作为一个 node module 设置</h3><p>一个 generator 的核心就是一个 Node.js 模块。</p><p>首先，为你即将写的 generator 创建一个文件夹。这个文件夹必须命名为 <code>generator-name</code> (这里的 <code>name</code> 就是你 generator 的名字)。这是很重要的，作为 Yeoman 的依赖文件系统来查找可用的 generators。</p><p>进入你的 generator 文件夹，创建一个 <code>package.json</code> 文件。 这个文件表明它是一个 Node.js 模块。你可以在你的命令行里运行 <code>npm init</code> 来生成这个文件或手动输入一下代码：</p><div class=highlight><pre><code class=language-json data-lang=json><span class=p>{</span>
  <span class=nt>"name"</span><span class=p>:</span> <span class=s2>"generator-name"</span><span class=p>,</span>
  <span class=nt>"version"</span><span class=p>:</span> <span class=s2>"0.1.0"</span><span class=p>,</span>
  <span class=nt>"description"</span><span class=p>:</span> <span class=s2>""</span><span class=p>,</span>
  <span class=nt>"files"</span><span class=p>:</span> <span class=p>[</span>
    <span class=s2>"app"</span><span class=p>,</span>
    <span class=s2>"router"</span>
  <span class=p>],</span>
  <span class=nt>"keywords"</span><span class=p>:</span> <span class=p>[</span><span class=s2>"yeoman-generator"</span><span class=p>],</span>
  <span class=nt>"dependencies"</span><span class=p>:</span> <span class=p>{</span>
    <span class=nt>"yeoman-generator"</span><span class=p>:</span> <span class=s2>"^0.24.1"</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>这个 generator <code>name</code> 属性必须以 <code>generator-</code> 为前缀。这个 <code>keywords</code> 属性必须包含 <code>"yeoman-generator"</code> 并且这个仓库必须有一个描述被索引到我们的 <a href=/generators/ >generators 页面</a>。</p><p>你应该确保你设置了最新版本的 <code>yeoman-generator</code> 作为一个依赖。你可以去运行：<code>npm install --save yeoman-generator</code>。</p><p>“file” 属性必须是由你的 generator 使用的文件排列和目录。</p><p>根据需要加入其他的 <a href=https://docs.npmjs.com/files/package.json#files><code>package.json</code> 属性</a>。</p><h3>文件树</h3><p>Yeoman 会深度链接到文件系统和你如何组织你的目录树。每个 sub-generator 都将包含在你自己的文件夹。</p><p>当你使用 <code>yo name</code> 为这个 <code>app</code> 的 generator时，这个默认的 generator 将会被使用。这必须包含在 <code>app/</code> 目录中。</p><p>当你使用 <code>yo name:subcommand</code> 时 Sub-generators 将被使用，存储在文件夹中，名字完全像一个子命令。</p><p>在一个示例项目中，目录树可能看起来像这样：</p><div class=highlight><pre><code class=language-text data-lang=text>├───package.json
├───app/
│   └───index.js
└───router/
    └───index.js
</code></pre></div><p>这个 generator 将暴露 <code>yo name</code> 和 <code>yo name:router</code> 命令。</p><p>你可能不喜欢把你所有的代码都保存在文件夹的根目录下。 幸运的是，Yeoman 允许在两个不同的目录结构。它会在 <code>./</code> 和 <code>generators/</code>中寻找去注册可用的 generators。</p><p>前面的例子也可以是如下：</p><div class=highlight><pre><code class=language-text data-lang=text>├───package.json
└───generators/
    ├───app/
    │   └───index.js
    └───router/
        └───index.js
</code></pre></div><p>如果您使用此第二个目录结构，确保你已经在你的 <code>generators</code> 文件夹下的 <code>package.json</code> 的 <code>files</code> 属性中指出。</p><div class=highlight><pre><code class=language-json data-lang=json><span class=p>{</span>
  <span class=nt>"files"</span><span class=p>:</span> <span class=p>[</span>
    <span class=s2>"generators/app"</span><span class=p>,</span>
    <span class=s2>"generators/router"</span>
  <span class=p>]</span>
<span class=p>}</span>
</code></pre></div><h2>扩展 generator</h2><p>一旦你的结构准备就绪，就可以开始写一个实际的 generator 了。</p><p>Yeoman 提供了一个基础的 generator，你可以扩展到实现你自己的行为。这个基本的 generator 将添加大部分的功能，希望能减轻你的任务。</p><p>怎样由这个基本的 generator 去扩展呢：</p><div class=highlight><pre><code class=language-js data-lang=js><span class=kd>var</span> <span class=nx>generators</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>'yeoman-generator'</span><span class=p>);</span>

<span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>generators</span><span class=p>.</span><span class=nx>Base</span><span class=p>.</span><span class=nx>extend</span><span class=p>();</span>
</code></pre></div><p>这个 <code>extend</code> 方法将扩展基本的类并允许你提供一个新的原型。此功能来自 <a href=https://github.com/SBoudrias/class-extend>Class-extend</a> 模块，并且如果你使用过 Backbone 你应该很熟悉。</p><p>我们将扩展的 generator 分配给 <code>module.exports</code>，使其能够提供给生态系统。这就是我们在 <a href=https://nodejs.org/api/modules.html#modules_module_exports>Node.js 的接口模块</a>。</p><h3>重写构造函数</h3><p>一些 generator 方法只能在 <code>cconstrutor</code> 函数中调用。这些特殊的方法可以做类似设置重要的状态控件的事情，也可能不在构造函数之外的函数。</p><p>重写 generator 构造器，你可以通过一个构造函数去 <code>extend()</code> 像这样：</p><div class=highlight><pre><code class=language-js data-lang=js><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>generators</span><span class=p>.</span><span class=nx>Base</span><span class=p>.</span><span class=nx>extend</span><span class=p>({</span>
  <span class=c1>// The name `constructor` is important here</span>
  <span class=nx>constructor</span><span class=o>:</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
    <span class=c1>// Calling the super constructor is important so our generator is correctly set up</span>
    <span class=nx>generators</span><span class=p>.</span><span class=nx>Base</span><span class=p>.</span><span class=nx>apply</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=nx>arguments</span><span class=p>);</span>

    <span class=c1>// Next, add your custom code</span>
    <span class=k>this</span><span class=p>.</span><span class=nx>option</span><span class=p>(</span><span class=s1>'coffee'</span><span class=p>);</span> <span class=c1>// This method adds support for a `--coffee` flag</span>
  <span class=p>}</span>
<span class=p>});</span>
</code></pre></div><h3>添加你自己的功能</h3><p>每个被加入到原型的方法，generator 都会运行一次，这叫做常驻序列。但是，正如我们在下一节中看到的，一些特殊的方法名称将触发一个特定的运行顺序。</p><p>让我们添加一些方法：</p><div class=highlight><pre><code class=language-js data-lang=js><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>generators</span><span class=p>.</span><span class=nx>Base</span><span class=p>.</span><span class=nx>extend</span><span class=p>({</span>
  <span class=nx>method1</span><span class=o>:</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>'method 1 just ran'</span><span class=p>);</span>
  <span class=p>},</span>
  <span class=nx>method2</span><span class=o>:</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>'method 2 just ran'</span><span class=p>);</span>
  <span class=p>}</span>
<span class=p>});</span>
</code></pre></div><p>当我们运行 generator 后，你会看到这些线程记录将打印到控制台。</p><h2>运行 generator</h2><p>在这一点上，你有一个工作的 generator。下一个合乎逻辑的步骤是运行它，看看它是否工作。</p><p>因为你是在本地开发的 generator，它还不能够作为一个全局的 npm 模块去获取。一个全局模块可以被创建并能使用 npm 链接到本地。你可能想这样做：</p><p>在命令行中，从你的 generator 项目的根目录（在 <code>generator-name/</code> 文件夹），打印：</p><div class=highlight><pre><code class=language-text data-lang=text>npm link
</code></pre></div><p>这将安装您的项目依赖项和链接一个全局模块到本地文件。npm 下载完后，你将能够使用 <code>yo name</code>,并且你应该能看到 <code>console.log</code>,预先定义，在终端中渲染。祝贺你，你已经建立了你的第一个 generator！</p><h3>找到项目根目录</h3><p>当你运行一个 generator，Yeoman 将以文件夹内容为基础计算出一些事情，然后运行它。</p><p>最重要的是，Yeoman 将从目录树中搜索 <code>.yo-rc.json</code>文件。如果发现，它会以该文件的位置作为项目的根。在后台，Yeoman 会该改变 <code>.yo-rc.json</code> 文件在当前文件的定位，并且在那儿运行 generator 请求。</p><p>存储模块创建 <code>.yo-rc.json</code> 文件。generator 在第一次运行 <code>this.config.save()</code> 将创建这个文件。</p><p>所以，如果您的 generator 没有在您当前的工作目录中运行，确保你是否有 <code>.yo-rc.json</code> 在你的目录树中。</p><h2>接下来做什么？</h2><p>读到这里之后，您应该能够创建一个本地 generator 并运行它。</p><p>如果这是你第一次写一个 generator，你一定要读下一节 <a href=/authoring/running-context.html>运行上下文和循环运行</a>。这一部分是理解 generator 运行语境至关重要，并确保它将与其它的 generator 和谐的组成 Yeoman 生态系统。文档的其他部分将提供的功能在Yeoman 的核心，它就是用来帮助你实现你的目标。</p><div class=contribute-doc>发现一个错误？一个不清楚的例子？通过派生并发送你的修改和建议来帮助我们改进文档。<a href=https://github.com/yeoman/yeoman.github.io/blob/source/app/authoring/index.md>改善此页面！</a></div></section></article></div></div><footer class=SiteFooter><div class=SiteFooter-donation><div class=Donation><div class=Donation-sticker-clipping><img src=/static/yeoman-character-sticker.51cef7e007.png class=Donation-sticker width=190 height=294 alt=Stickers!></div><div class=Donation-text><a href=https://www.stickermule.com/user/1070704235/stickers>Show your love for <strong>Yeoman</strong>,<br> wear our <strong>sticker</strong>!</a></div></div></div><ul class=SiteFooter-links><li><a href=https://plus.google.com/101063139999404044459/posts class=icon><img src=/static/social-gplus.5223e7bc73.svg class=SiteFooter-icon alt=Google+></a></li> <li><a href=https://twitter.com/yeoman class=icon><img src=/static/social-twitter.c359540fc8.svg class=SiteFooter-icon alt=Twitter></a></li> <li><a href=https://github.com/yeoman/yeoman class=icon><img src=/static/social-github.89959ef390.svg class=SiteFooter-icon alt=Github></a></li> <li><a href=/blog/atom.xml class=icon><img src=/static/social-feed.ad4bea7819.svg class=SiteFooter-icon alt=Feed></a></li> <li class=mobile-ln></li> <li><a href=http://yeoman.io/generator/ class="SiteFooter-button SiteFooter-button--light">API</a></li> <li><a href=https://github.com/yeoman/yeoman.github.io/blob/source/app/authoring/index.md class=SiteFooter-button title="Edit this page on Github to help improve the site">Improve this page</a></li></ul></footer><script src=//cdn.bootcss.com/jquery/2.1.0/jquery.min.js></script><script src=/static/bundle-5136.59df1aab5d.js async></script><script>!function(a,b,c){'undefined'!=typeof c.module&&c.module.exports?c.module.exports=b():'undefined'!=typeof c.define&&'function'==c.define&&c.define.amd?define(a,b):c[a]=b()}('$script',function(){function a(a,b){for(var c=0,d=a.length;c<d;++c)if(!b(a[c]))return m;return 1}function b(b,c){a(b,function(a){return!c(a)})}function c(f,g,m){function o(a){return a.call?a():i[a]}function p(){if(!--t){i[s]=1,r&&r();for(var c in k)a(c.split('|'),o)&&!b(k[c],o)&&(k[c]=[])}}f=f[n]?f:[f];var q=g&&g.call,r=q?g:m,s=q?f.join(''):g,t=f.length;return setTimeout(function(){b(f,function(a){return l[a]?(s&&(j[s]=1),2==l[a]&&p()):(l[a]=1,s&&(j[s]=1),d(!h.test(a)&&e?e+a+'.js':a,p),void 0)})},0),c}function d(a,b){var c=f.createElement('script'),d=m;c.onload=c.onerror=c[r]=function(){c[p]&&!/^c|loade/.test(c[p])||d||(c.onload=c[r]=null,d=1,l[a]=2,b())},c.async=1,c.src=a,g.insertBefore(c,g.firstChild)}var e,f=document,g=f.getElementsByTagName('head')[0],h=/^https?:\/\//,i={},j={},k={},l={},m=!1,n='push',o='DOMContentLoaded',p='readyState',q='addEventListener',r='onreadystatechange';return!f[p]&&f[q]&&(f[q](o,function s(){f.removeEventListener(o,s,m),f[p]='complete'},m),f[p]='loading'),c.get=d,c.order=function(a,b,d){!function e(f){f=a.shift(),a.length?c(f,e):c(f,b,d)}()},c.path=function(a){e=a},c.ready=function(d,e,f){d=d[n]?d:[d];var g=[];return!b(d,function(a){i[a]||g[n](a)})&&a(d,function(a){return i[a]})?e():!function(a){k[a]=k[a]||[],k[a][n](e),f&&f(g)}(d.join('|')),c},c},this);var _gaq=[['_setAccount','UA-32956520-1'],['_setDomainName','.yeoman.io'],['_trackPageview'],['_trackPageLoadTime']]//# sourceMappingURL=../static/yowebapp-5207.b6a7e77eb7.map </script></div></body></html>